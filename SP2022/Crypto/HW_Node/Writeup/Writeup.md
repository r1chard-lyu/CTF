# [HW] Node

1.å…ˆè§€å¯Ÿäº†é¡Œç›®ï¼Œå¾é¡Œç›® check_point å‡½æ•¸å¯ä»¥æ¨æ¸¬é€™é¡Œæ˜¯åœ¨è€ƒæ©¢åœ“æ›²ç·šï¼Œè€Œé€™é¡Œçš„æ©¢åœ“æ›²ç·šæ˜¯

$y^2 = x^3 -3x + 2$

```python
def check_point(P):
    if P == O:
        return True
    else:
        return (P.y**2 - (P.x**3 + a*P.x + b)) % p == 0 and 0 <= P.x < p and 0 <= P.y < p
```

2.é€™é‚Šæœé›†äº†ç¾æœ‰çš„è³‡è¨Š ï¼Œä¸¦æ•´ç†chal.pyåŠoutput.txtçš„åƒæ•¸è³‡è¨Šå¦‚ä¸‹

```python
#p is a prime
p = 143934749405770267808039109533241671783161568136679499142376907171125336784176335731782823029409453622696871327278373730914810500964540833790836471525295291332255885782612535793955727295077649715977839675098393245636668277194569964284391085500147264756136769461365057766454689540925417898489465044267493955801
#a and b are 
a = -3
b = 2
#G is a input point
Gx,Gy =  101806057140780850544714530443644783825785167075147195900696966628348944447492085252540090679241301721340985975519224144331425477628386574016040358648752353263802400527250163297781189749285392087154377684890287451078937692380556192126971669069015673662635561425735593795743852141232711066181542250670387203333, 21070877061047140448223994337863615306499412743288524847405886929295212764999318872250771845966630538832460153205159221566590942573559588219757767072634072564645999959084653451405037079311490089767010764955418929624276491280034578150363584012913337588035080509421139229710578342261017441353044437092977119013
#F is a output point
Fx,Fy = 98015495932907076864096258407988962007376328849899810250322002325625359735922937686533359455570369291999900476297694445557845368802830788062976760815467239661283157094425185337540578842851843497177780602415322706226426265515846633379203744588829488176045794602858847864402137150751961826536524265308139934971 , 87166136054299272658534592982430361675520319206099499992529237663935246617561944716447831162561604277568397630920048376392806047558420891922813475124718967889074322061747341780368922425396061468851460185861964432392408561769588468524187868171386564578362923777824279396698093857550091931091983893092436864205

```

3.åˆ©ç”¨ sagemath çš„ ****Elliptic curves**** å»å®šç¾©é€™å€‹æ©¢åœ“æ›²ç·šï¼Œå°‡å…¶ç¨‹å¼ç¢¼æ”¾åˆ° sage æœƒç™¼ç¾ï¼Œé€™æ˜¯ä¸€å€‹ Singular Curveã€‚é©—ç®— ( 4a^3 + 27b^2 = 0 ) éå¾Œä¹Ÿè­‰å¯¦äº†é€™æ˜¯ä¸€å€‹ Singular Curveï¼Œ

```python
E = EllipticCurve([0,0,0,-3,2])
```

![æˆªåœ– 2022-10-14 ä¸Šåˆ10.55.29.png](%5BHW%5D%20Node%20565d78d46b224c0299c92fde1240f7c1/%25E6%2588%25AA%25E5%259C%2596_2022-10-14_%25E4%25B8%258A%25E5%258D%258810.55.29.png)

![æˆªåœ– 2022-10-14 ä¸Šåˆ10.58.34.png](%5BHW%5D%20Node%20565d78d46b224c0299c92fde1240f7c1/%25E6%2588%25AA%25E5%259C%2596_2022-10-14_%25E4%25B8%258A%25E5%258D%258810.58.34.png)

5.æ¥ä¸‹ä¾†æˆ‘å€‘çŸ¥é“è€å¸«ä¸Šèª²æœ‰æ•™ï¼Œè‹¥æ©¢åœ“æ›²ç·šæ˜¯ Singular Curveçš„è©±ï¼ŒThere are two types of singular point 

Node : $y^2 = (x-Î±)^2(x-Î²)$

Cusp : $y^2 = x^3$

é€™é‚Šå¯ä»¥å¾ˆæ˜é¡¯çŸ¥é“ï¼Œé¡Œç›®çš„æ›²ç·šæ˜¯ Node çš„ Formï¼Œå¾åšåœ–å‡ºä¾†å¾ˆæ˜é¡¯å¯ä»¥çœ‹åˆ°å…¶æœ‰ä¸‰å€‹æ ¹ 

x = 1 , 1 ,-2 ( 1 æ˜¯é‡æ ¹ ï¼‰ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥å°‡åŸæ›²ç·šåˆ†è§£ç‚º Node çš„ From

$y^2 = (x-1)^2(x+2)$   ï¼Œå¾—åˆ° $Î± = 1,Î² = -2$ 

![æˆªåœ– 2022-10-14 ä¸Šåˆ10.56.47.png](%5BHW%5D%20Node%20565d78d46b224c0299c92fde1240f7c1/%25E6%2588%25AA%25E5%259C%2596_2022-10-14_%25E4%25B8%258A%25E5%258D%258810.56.47.png)

6.ç„¶å¾Œ Node è§£æ³•åƒè€ƒäº†èª²ç¨‹è¬›ç¾© Crypto_0930.ppt - 41 é ï¼Œéœ€è¦å…ˆåœ¨æ©¢åœ“æ›²ç·šçš„ Field ä¸‹ï¼Œå®šç¾©ä¸€å€‹å‡½æ•¸ phiï¼Œç„¶å¾Œåˆ©ç”¨ hormomorphism çš„ Property å»åŒ–ç°¡å‡½æ•¸ï¼Œæœ€å¾Œå»è§£ Discrete Log ã€‚

![æˆªåœ– 2022-10-16 ä¸‹åˆ3.02.06.png](%5BHW%5D%20Node%20565d78d46b224c0299c92fde1240f7c1/%25E6%2588%25AA%25E5%259C%2596_2022-10-16_%25E4%25B8%258B%25E5%258D%25883.02.06.png)

7.æœ‰äº†é€™å€‹è§£æ³•å¾Œï¼Œå°±æŒ‰ç…§æ­¥é©Ÿå»å¯¦ä½œ

a.ç›´æ¥æ ¹æ“šè¬›ç¾©å·²ç¶“è­‰æ˜éçš„çµæœå»å¯¦ä½œå‡½æ•¸ phiï¼Œ

```python
def phi(x,y):
    return  ( y + (a-b)* * (0.5) * (x-a) ) * inverse(( y - (a-b)* * (0.5) * (x-a) ) ,p)
```

b.åˆ©ç”¨ Homomorphism çš„æ€§è³ªå»æ¨å°å‡½æ•¸ï¼Œç™¼ç¾å¯ä»¥è®Šæˆ discrete log problem on (ğ”½p, Ã—)ï¼Œä½†å‰ææ˜¯ p è¦æ˜¯ smooth prime ï¼Œå› æ­¤ä¹Ÿç”¨ sagemath çš„ factor å»é©—ç®—ï¼Œè­‰å¯¦äº†ï¼Œé€™æ˜¯ä¸€å€‹å¯ä»¥è§£çš„ discrete log problemã€‚

$F = flag*G \ \ (\ mod\ p\ )$

$â‡’ Ï†(F) â‰¡ Ï†(flag*G )\ \ (\ mod\ p\ )$

$â‡’ Ï†(F) â‰¡  Ï†(G)^{flag} \ \ (\ mod\ p\ )$

$â‡’ Ï†(G)^{flag} â‰¡ Ï†(F) \ \ (\ mod\ p\ )$

![æˆªåœ– 2022-10-14 ä¸Šåˆ11.00.24.png](%5BHW%5D%20Node%20565d78d46b224c0299c92fde1240f7c1/%25E6%2588%25AA%25E5%259C%2596_2022-10-14_%25E4%25B8%258A%25E5%258D%258811.00.24.png)

1. æ–¼æ˜¯æˆ‘æœ‰äº†ä»¥ä¸‹çš„å¯¦ä½œéç¨‹ï¼Œä½†æœƒç™¼ç¾å•é¡Œï¼Œdiscrete_log è§£å‡ºä¾†çš„ flag æœƒæ˜¯éŒ¯çš„ã€‚

```python
#In sgae
Gx, Gy = (101806057140780850544714530443644783825785167075147195900696966628348944447492085252540090679241301721340985975519224144331425477628386574016040358648752353263802400527250163297781189749285392087154377684890287451078937692380556192126971669069015673662635561425735593795743852141232711066181542250670387203333, 21070877061047140448223994337863615306499412743288524847405886929295212764999318872250771845966630538832460153205159221566590942573559588219757767072634072564645999959084653451405037079311490089767010764955418929624276491280034578150363584012913337588035080509421139229710578342261017441353044437092977119013)
Fx, Fy = (98015495932907076864096258407988962007376328849899810250322002325625359735922937686533359455570369291999900476297694445557845368802830788062976760815467239661283157094425185337540578842851843497177780602415322706226426265515846633379203744588829488176045794602858847864402137150751961826536524265308139934971 , 87166136054299272658534592982430361675520319206099499992529237663935246617561944716447831162561604277568397630920048376392806047558420891922813475124718967889074322061747341780368922425396061468851460185861964432392408561769588468524187868171386564578362923777824279396698093857550091931091983893092436864205)
p = 143934749405770267808039109533241671783161568136679499142376907171125336784176335731782823029409453622696871327278373730914810500964540833790836471525295291332255885782612535793955727295077649715977839675098393245636668277194569964284391085500147264756136769461365057766454689540925417898489465044267493955801

def phi(x,y):
    return  ( y + (a-b)* * (0.5) * (x-a) ) * inverse(( y - (a-b)* * (0.5) * (x-a) ) ,p)

a = phi( Gx , Gy )
b = phi( Fx , Fy )
discrete_log(b,a)
```

```python
#In python
from Crypto.Util.number import long_to_bytes
f = 2676073546977586965708398411271300382150616782779323939389114774325018659340980262484099358301651090323175215985064390229527492479938197361439869686885710900330671245571434966831486730806281974603946541751744391600045505443675351815308499587560257765088996542502145770357682162979637041147
print(long_to_bytes(f))
```

9.ç ”ç©¶äº†å¾ˆä¹…ä¹‹å¾Œï¼Œæƒ³åˆ°é€™é‚Šæ˜¯åœ¨æ©¢åœ“æ›²ç·šçš„ Field (ğ”½p, Ã—)ä¹‹ä¸‹ï¼Œå› æ­¤ï¼Œæ¯å€‹é‹ç®—éƒ½æœƒè¦ Mod p ï¼Œå°‡ Mod p å†åŠ å…¥ phi å‡½æ•¸çš„é‹ç®—ä¸­ã€‚ 

```python
#In sage
Gx, Gy = (101806057140780850544714530443644783825785167075147195900696966628348944447492085252540090679241301721340985975519224144331425477628386574016040358648752353263802400527250163297781189749285392087154377684890287451078937692380556192126971669069015673662635561425735593795743852141232711066181542250670387203333, 21070877061047140448223994337863615306499412743288524847405886929295212764999318872250771845966630538832460153205159221566590942573559588219757767072634072564645999959084653451405037079311490089767010764955418929624276491280034578150363584012913337588035080509421139229710578342261017441353044437092977119013)
Fx, Fy = (98015495932907076864096258407988962007376328849899810250322002325625359735922937686533359455570369291999900476297694445557845368802830788062976760815467239661283157094425185337540578842851843497177780602415322706226426265515846633379203744588829488176045794602858847864402137150751961826536524265308139934971 , 87166136054299272658534592982430361675520319206099499992529237663935246617561944716447831162561604277568397630920048376392806047558420891922813475124718967889074322061747341780368922425396061468851460185861964432392408561769588468524187868171386564578362923777824279396698093857550091931091983893092436864205)
p = 143934749405770267808039109533241671783161568136679499142376907171125336784176335731782823029409453622696871327278373730914810500964540833790836471525295291332255885782612535793955727295077649715977839675098393245636668277194569964284391085500147264756136769461365057766454689540925417898489465044267493955801

def phi(x,y):
    return  Mod( y + sqrt(Mod(3,p)) * ( x - 1) ,p) * pow(Mod(y - sqrt(Mod(3,p)) * ( x - 1) ,p) ,-1 ,p )

a = phi( Gx , Gy )
b = phi( Fx , Fy )
discrete_log(b,a)
```

```python
#In python
from Crypto.Util.number import long_to_bytes
f = 2676073546977586965708398411271300382150616782779323939389114774325018659340980262484099358301651090323175215985064390229527492479938197361439869686885710900330671245571434966831486730806281974603946541751744391600045505443675351815308499587560257765088996542502145770357682162979637041147
print(long_to_bytes(f))
```

10.æœ€å¾Œå¾—åˆ°æˆåŠŸå¾—åˆ° FLAG{I_h3arD_th47_ECDlp_1s_h4rDEr_THaN_dlp}

Note. åƒè€ƒè³‡æ–™

(1). [https://wiki.sagemath.org/quickref?action=AttachFile&do=get&target=quickref-zh.pdf](https://wiki.sagemath.org/quickref?action=AttachFile&do=get&target=quickref-zh.pdf)

(2). [https://crypto.stackexchange.com/questions/61302/how-to-solve-this-ecdlp](https://crypto.stackexchange.com/questions/61302/how-to-solve-this-ecdlp)

(3). [https://ithelp.ithome.com.tw/articles/10251031](https://ithelp.ithome.com.tw/articles/10251031)

(4). [https://drive.google.com/file/d/1WPa9gs-m9X-jfBRsOM17tLPSTJy7RAYu/edit?rtpof=true&ddrp=1#](https://drive.google.com/file/d/1WPa9gs-m9X-jfBRsOM17tLPSTJy7RAYu/edit?rtpof=true&ddrp=1#)